<!DOCTYPE html>
<html>

<head>
	<title>test</title>
	<style>
		html,
		body {
			margin: 0;
			padding: 0;
		}

		table.sortable thead {
			background-color: #eee;
			color: #666666;
			font-weight: bold;
			cursor: default;
		}

		table.sortable th {
			cursor: pointer;
		}

		table.sortable th:hover {
			color: red;
		}

		table.sortable td {
			padding: 2px;
		}

		table tr:nth-of-type(5n) td {
			border-bottom: 1px solid black;
		}

		input[type=button] {
			cursor: pointer;
		}

		input[type=button]:hover {
			color: red;
		}
	</style>
	<script src="sorttable.min.js"></script>
	<script src="juration.min.js"></script>
	<script>
		window.addEventListener("load", function () {
			const bujoin = document.getElementById("join");
			const buref = document.getElementById("refresh");
			const busjoin = document.getElementById("steamjoin");
			function buttonsDisabled(state) {
				bujoin.disabled = state;
				buref.disabled = state;
				busjoin.disabled = state;
			}
			document.addEventListener("keydown", function (e) {
				const F5 = 116;
				if (e.keyCode == F5) {
					e.preventDefault();
					buref.click();
				}
			});
			bujoin.addEventListener("click", function () {
				buttonsDisabled(true);
				native.runJoin();
				buttonsDisabled(false);
			});
			buref.addEventListener("click", function () {
				buttonsDisabled(true);
				native.updateInfo();
				const info = native.data.info;
				if (!info.Name) {
					alert("could not contact server");
					buttonsDisabled(false);
					return;
				}
				document.getElementById("name").innerText = info.Name;
				document.getElementById("map").innerText = info.Map;
				document.getElementById("count").innerText = info.Players;
				document.getElementById("maxcount").innerText = info.MaxPlayers;
				native.updatePlayers();
				const players = native.data.players;
				if (!players.length) {
					buttonsDisabled(false);
					return;
				}
				const table = document.querySelector("#players");
				const tbody = table.querySelector("tbody");
				tbody.innerHTML = "";
				for (var i = 0; i < players.length; i++) {
					const d = players[i].Duration;
					const secs = (d / 1000000000) + (d % 1000000000) / 1000000000;
					const tr = document.createElement("tr");
					var td = document.createElement("td");
					td.textContent = players[i].Name;
					tr.appendChild(td);

					td = document.createElement("td");
					td.textContent = players[i].Score;
					tr.appendChild(td);

					td = document.createElement("td");
					td.textContent = juration.stringify(secs);
					td.setAttribute("sorttable_customkey", '' + secs);
					tr.appendChild(td);

					td = document.createElement("td");
					td.textContent = (players[i].Score / secs).toFixed(6);
					tr.appendChild(td);
					tbody.appendChild(tr);
				}
				const headers = table.querySelectorAll("th");
				for (var i = 0; i < headers.length; i++) {
					headers[i].className = headers[i].className
						.replace('sorttable_sorted_reverse', '')
						.replace('sorttable_sorted', '');
				}
				sorttable.innerSortFunction.apply(headers[3], []);
				sorttable.reverse(tbody);
				buttonsDisabled(false);
			});
			busjoin.addEventListener("click", function () {
				buttonsDisabled(true);
				native.runSteamJoin();
				buttonsDisabled(false);
			});
			setTimeout(function () {
				buref.click();
			}, 20);
		});
	</script>
</head>

<body>
	<input type="button" id="refresh" value="refresh">
	<input type="button" id="join" value="join">
	<input type="button" id="steamjoin" value="steam join">
	<br/> Name:
	<span id="name"></span>
	<br/> Map:
	<span id="map"></span>
	<br/> Players:
	<span id="count"></span>/
	<span id="maxcount"></span>
	<br/>
	<table id="players" class="sortable">
		<thead>
			<tr>
				<th class="sorttable_alpha">Name</th>
				<th class="sorttable_numeric">Score</th>
				<th class="sorttable_numeric">Online</th>
				<th class="sorttable_numeric">Score/Second</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>
</body>

</html>